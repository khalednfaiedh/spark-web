<div class="col-md-12 col-lg-12" style="width:1500px; height: 750px">

  <div class="row">
    <div class="col-lg-12" style="width:1200px; height: 300px"><br>
      <nb-card-body>
        <div *ngIf="contrat.type=='Avenant'">
          <div class="row full-name-inputs">
            <div class="form-group col-md-12 col-lg-12 input-group-sm">
              <label _ngcontent-udb-c31="" class="label">Contrat initial :</label>
              <ng-select name="contrat" [disabled]="disabled" placeholder="Dossier initial" [appendTo]="'body'"
                [items]="contratParents" bindLabel="idContrat" bindValue="idContrat"
                [(ngModel)]="contrat.idContratParent" style="width:100%;" (change)="changeDataContrat()"
                [ngModelOptions]="{standalone: true}">
              </ng-select>
            </div>
          </div>
        </div>
        <div class="row full-name-inputs">
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Client :</label>
            <ng-select name="client" [disabled]="disabled" placeholder="Client" [appendTo]="'body'" [items]="clients"
              bindLabel="nameC" bindValue="code_clt" [(ngModel)]="contrat.codeClt" style="width:100%;"
              (change)="SelectClient()" [ngModelOptions]="{standalone: true}">
            </ng-select>
          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Active :</label>
            <ng-select [disabled]="disabled" name="active" [(ngModel)]="contrat.active"
              [ngModelOptions]="{standalone: true}">
              <ng-option value='true'>Oui </ng-option>
              <ng-option value='false'>Non</ng-option>
            </ng-select>
          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Type de contrat :</label>
            <ng-select [disabled]="disabled" hero placeholder="Type de contrat" name="type" [(ngModel)]="contrat.type"
              [ngModelOptions]="{standalone: true}">
              <ng-option value='Contrat initial'>Contrat initial </ng-option>
              <ng-option value='Contrat reconduit'>Contrat reconduit </ng-option>
              <ng-option value='Contrat en veilleuse'>Contrat en veilleuse </ng-option>
              <ng-option value='Avenant'>Avenant</ng-option>
            </ng-select>
          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Unité de transaction :</label>

            <ng-select [disabled]="disabled" name="devise" placeholder="Monnais" [appendTo]="'body'" [items]="devises"
              style="width:100%;" bindLabel="sigle" bindValue="idT" (change)="changeUniteTransaction()"
              [(ngModel)]="contrat.idUniteTransaction">
            </ng-select>
          </div>

        </div>
        <div class="row full-name-inputs">
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Code :</label>
            <input [disabled]="disabled" placeholder="code" class="form-control" name="code" [(ngModel)]="contrat.code">
          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Désignation :</label>
            <input [disabled]="disabled" placeholder="Désignation" class="form-control" name="designation"
              [(ngModel)]="contrat.designation">
          </div>

          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Unité de temps (jours) :</label>

            <input type="number" [disabled]="disabled" name="devise" placeholder="Unité de temps" class="form-control"
              [(ngModel)]="contrat.uniteTemps" />

          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Pénalité de retard :</label>
            <input [disabled]="disabled" placeholder="Pénalité de retard" class="form-control" name="penaliteRetard"
              [(ngModel)]="contrat.penaliteRetard">
          </div>
        </div>
        <div class="row full-name-inputs">

          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Date début du contrat :</label>
            <input [disabled]="disabled" placeholder="Date début du contrat" name="dateDebutContrat"
              [(ngModel)]="contrat.dateDebut" class="form-control" [nbDatepicker]="dateDebutContrat" required>
            <nb-datepicker #dateDebutContrat></nb-datepicker>
          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Date fin du contrat :</label>
            <input [disabled]="disabled" placeholder="Date fin du contrat" name="dateFinContrat"
              [(ngModel)]="contrat.dateFin" class="form-control" [nbDatepicker]="dateFinContrat" required>
            <nb-datepicker #dateFinContrat></nb-datepicker>
          </div>

          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Mode de paiement :</label>
            <ng-select [disabled]="disabled" name="modesPaiements" placeholder="Mode de paiement" [appendTo]="'body'"
              [items]="modesPaiements" bindLabel="typePaiement" bindValue="idPaiement" [(ngModel)]="contrat.idPaiement"
              style="width:100%;" [ngModelOptions]="{standalone: true}">
            </ng-select>

          </div>
          <div class="form-group col-md-3 col-lg-3 input-group-sm">
            <label _ngcontent-udb-c31="" class="label">Type de paiement :</label>
            <ng-select [disabled]="disabled" [(ngModel)]="contrat.typePaiement">
              <ng-option value="Date fixe">Date fixe</ng-option>
              <ng-option value="Par période">Par période</ng-option>
            </ng-select>

          </div>
        </div>
        <div *ngIf="contrat.typePaiement=='Date fixe'">
          <div [hidden]="false">
            <div class="row full-name-inputs">
              <div class="form-group col-md-4 col-lg-4 input-group-sm">
                <label _ngcontent-udb-c31="" class="label">Date de paiement :</label>
                <input [disabled]="disabled" name="datePaiement" placeholder="Date de paiement" class="form-control"
                  [(ngModel)]="contrat.datePaiement" [nbDatepicker]="datePaiement" />
                <nb-datepicker #datePaiement></nb-datepicker>
              </div>
            </div>
          </div>
        </div>


        <div *ngIf="contrat.typePaiement=='Par période'">
          <div [hidden]="false">
            <div class="row full-name-inputs">
              <div class="form-group col-md-4 col-lg-4 input-group-sm">
                <label _ngcontent-udb-c31="" class="label">Startégie de paiement :</label>
                <ng-select name="typeMontant" placeholder="Startégie de paiement" [(ngModel)]="contrat.strategie">
                  <ng-option value="Fixation en pourcentage">Fixation en pourcentage</ng-option>
                  <ng-option value="Fixation en jours">Fixation en jours</ng-option>
                </ng-select>
              </div>
              <div class="form-group col-md-8 col-lg-8 input-group-sm">
                <label _ngcontent-udb-c31="" class="label"> Condition de paiement :</label>
                <ng-select name="conditionPaiements" placeholder="Condition de paiement" [appendTo]="'body'"
                  style="width:100%;" [(ngModel)]="contrat.idConditionpaiement" bindValue="id"
                  [items]="conditionPaiements" bindLabel="listCondition">
                </ng-select>
              </div>

            </div>
          </div>
        </div>







        <div class="row full-name-inputs">


          <div class="form-group col-md-12 col-lg-12 input-group-sm" style="margin-bottom: 20px;">
            <label _ngcontent-udb-c31="" class="label">Commentaire :</label>

            <textarea [disabled]="disabled" type="text" placeholder="Commentaire" class="form-control"
              [(ngModel)]="contrat.commentaire"></textarea>
          </div>

        </div>





        <nb-card>
          <nb-card-body>
            <!--   <ng2-smart-table (custom)="onCustom($event)" [settings]="settings" [source]="source"
            (editConfirm)="show($event)">
          </ng2-smart-table>-->
            <div ng-repeat="let listProductForm of listProductForm" id="main-form-content1">
              <form [formGroup]="listProductForm">
                <div class="row full-name-inputs">
                  <div class="col-md-12 col-lg-12">
                    <div class="pull-right" style="float: right;">
                      <button type="button" class="btn btn-sm btn-success" style="width: 70px;" title="Add More"
                        (click)="addItem()" [disabled]="disabled">+</button>
                    </div><br><br>
                  </div><br>
                  <div class="col-md-12 col-lg-12">
                    <div formArrayName="listeProduct">
                      <div *ngFor="let item1 of listeProductArray.controls; let j = index;">
                        <div [formGroupName]="j">
                          <div class="row full-name-inputs label">
                            <div class="input-group col-md-3   input-group-sm">
                              <label for="idProduct">Produit :</label>
                            </div>

                            <div class="input-group col-md-2   input-group-sm">
                              <label for="idUnite">Unité de mesure :</label>
                            </div>

                            <div class="input-group col-md-2   input-group-sm">
                              <label for="prixUnitaire">Prix unitaire :</label>
                            </div>
                            <div class="input-group col-md-2 input-group-sm">
                              <label for="quantity">Quantité :</label>
                            </div>
                            <div class="input-group col-md-1   input-group-sm">
                              <label for="prixTotal">Prix total :</label>
                            </div>
                          </div>
                          <div class="row full-name-inputs">

                            <div class="input-group col-md-3 col-lg-3 input-group-sm">
                              <ng-select name="idProduct" placeholder="Produit'" [items]="products" style="width:100%;"
                                formControlName="idProduct" bindValue="idProduct" bindLabel="designation">

                              </ng-select>
                              <div class="help-block"></div>
                            </div>


                            <div class="form-group col-md-2 col-lg-2 input-group-sm">

                              <ng-select name="idUnite" [items]="unitiesMesureProduct" placeholder="Unité de mesure"
                                formControlName="idUnite" (focus)="changeUniteMesureParProduct(j)" bindValue="idUnite"
                                bindLabel="unite" style="width:100%;" (change)="getPrixProduct(j)">
                              </ng-select>
                            </div>
                            <div class="input-group col-md-2 col-lg-2 input-group-sm">

                              <input type="text" placeholder="Prix unitaire" name="prixUnitaire" class="form-control"
                                formControlName="prixUnitaire" disabled style="padding: 0.4rem 1.25rem;" />
                            </div>
                            <div class="input-group col-md-2 col-lg-2 input-group-sm">

                              <input type="number" placeholder="Quantité" name="quantity" class="form-control"
                                formControlName="quantitytot" style="padding: 0.4rem 1.25rem;" />
                            </div>
                            <div class="input-group col-md-2 col-lg-2 input-group-sm">

                              <input type="text" placeholder="Prix unitaire" name="prixTot" class="form-control"
                                formControlName="prixTot" disabled style="padding: 0.4rem 1.25rem;" />
                            </div>
                            <div class="remove col-md-1 col-lg-1 " *ngIf=" j!=0 ">
                              <button title="Remove" (click)="removeItem(j)" nbButton status="danger" size="xsmall"
                                style="height: 2.25rem;padding: 0px 5px 0px 5px;margin-top: 0.125rem;"> <i
                                  class="fas fa-trash-alt"></i></button>
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </form>
            </div>
          </nb-card-body>
        </nb-card>
        <div *ngIf="etat=='show'">
          <nb-card>
            <nb-card-header class="text-center">
              Liste des sous contrat
            </nb-card-header>

            <nb-card-body>
              <ng2-smart-table class="full-width text-center" [settings]="settings" [source]="source">
              </ng2-smart-table>
            </nb-card-body>
          </nb-card>
        </div>
      </nb-card-body>

      <div [hidden]="disabled" style="text-align:right;">
        <button nbButton style="cursor: pointer;margin: 0.5rem;align-content: center;" status="success"
          (click)="addContrat(listProductForm.value)">{{ARCM}}</button>
        <button nbButton style="cursor: pointer;margin: 0.5rem;align-content: center;" status="danger"
          (click)="close()">Annuler</button>

      </div>

    </div>

  </div>
</div>